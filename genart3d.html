<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generative Art & Glasses-Free 3D</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            background-color: #121212; 
            color: #e0e0e0;
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            margin: 0; 
            padding: 20px; 
            min-height: 100vh;
            text-align: center; 
        }
        h1 { 
            color: #ffffff; 
            font-weight: 300; 
            margin-bottom: 10px; 
        }
        
        /* Menu Bar Styles */
        .menu-bar {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            border-radius: 12px;
            padding: 15px 20px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-items: center;
            justify-content: center;
            min-width: 300px;
        }
        
        .menu-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        
        .menu-label {
            font-size: 12px;
            color: #b3d9ff;
            font-weight: 500;
        }
        
        select, .color-selector {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            padding: 8px 12px;
            color: #ffffff;
            font-size: 14px;
            outline: none;
            transition: all 0.3s ease;
        }
        
        select:hover, .color-selector:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
        }
        
        select:focus {
            background: rgba(255, 255, 255, 0.2);
            border-color: #4dabf7;
            box-shadow: 0 0 0 2px rgba(77, 171, 247, 0.3);
        }
        
        .color-selector {
            display: flex;
            gap: 8px;
            padding: 6px;
        }
        
        .color-option {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .color-option:hover {
            transform: scale(1.1);
            border-color: #ffffff;
        }
        
        .color-option.active {
            border-color: #4dabf7;
            box-shadow: 0 0 0 2px rgba(77, 171, 247, 0.5);
        }
        
        /* Particle Colors */
        .particle-red { background-color: #ff4757; }
        .particle-orange { background-color: #ff7f50; }
        .particle-yellow { background-color: #ffd700; }
        .particle-pure-red { background-color: #ff0000; }
        
        /* Background Colors */
        .bg-blue { background-color: #2040f1; }
        .bg-cyan { background-color: #00b894; }
        .bg-purple { background-color: #6c5ce7; }
        .bg-black { background-color: #000000; }
        
        /* Particle Size Controls */
        .size-controls {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .size-button {
            width: 28px;
            height: 28px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #ffffff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            user-select: none;
        }
        
        .size-button:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
            transform: scale(1.1);
        }
        
        .size-button:active {
            transform: scale(0.95);
        }
        
        .size-display {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 12px;
            color: #ffffff;
            min-width: 20px;
            text-align: center;
        }
        
        code { 
            background-color: #2a2a2a; 
            padding: 10px 15px; 
            border-radius: 5px; 
            font-family: "Courier New", monospace; 
            font-size: 0.7em;
            display: block; 
            white-space: pre-wrap; 
            text-align: center; 
            margin: 20px 0; 
        }
        
        #canvas-container {
            margin-top: 20px; 
            box-shadow: 0 0 25px rgba(255, 255, 255, 0.2); 
            border-radius: 8px; 
            overflow: hidden;
        }
        
        a { 
            color: #4dabf7; 
            text-decoration: none; 
        }
        
        a:hover { 
            text-decoration: underline; 
        }
        
        @media (max-width: 768px) {
            .menu-bar {
                flex-direction: column;
                gap: 15px;
            }
            
            .menu-item {
                width: 100%;
            }
            
            select, .color-selector {
                width: 100%;
                max-width: 200px;
            }
        }
    </style>
</head>
<body>
    <h1 id="main-title">Generative Art & Glasses-Free 3D</h1>
    
    <!-- Menu Bar -->
    <div class="menu-bar">
        <div class="menu-item">
            <label class="menu-label" id="code-label">Code Selection</label>
            <select id="code-selector">
            </select>
        </div>
        
        <div class="menu-item">
            <label class="menu-label" id="particle-label">Particle Color</label>
            <div class="color-selector" id="particle-colors">
                <div class="color-option particle-red active" data-color="red"></div>
                <div class="color-option particle-orange" data-color="orange"></div>
                <div class="color-option particle-yellow" data-color="yellow"></div>
                <div class="color-option particle-pure-red" data-color="pure-red"></div>
            </div>
        </div>
        
        <div class="menu-item">
            <label class="menu-label" id="bg-label">Background Color</label>
            <div class="color-selector" id="background-colors">
                <div class="color-option bg-blue active" data-color="blue"></div>
                <div class="color-option bg-cyan" data-color="cyan"></div>
                <div class="color-option bg-purple" data-color="purple"></div>
                <div class="color-option bg-black" data-color="black"></div>
            </div>
        </div>
        
        <div class="menu-item">
            <label class="menu-label" id="size-label">Particle Size</label>
            <div class="size-controls">
                <div class="size-button" id="size-decrease">−</div>
                <div class="size-display" id="size-display">1.6</div>
                <div class="size-button" id="size-increase">+</div>
            </div>
        </div>

        <div class="menu-item">
            <label class="menu-label" id="canvas-label">Canvas Size</label>
            <div class="size-controls">
                <div class="size-button" id="canvas-decrease">−</div>
                <div class="size-display" id="canvas-display">140</div>
                <div class="size-button" id="canvas-increase">+</div>
            </div>
        </div>

        <div class="menu-item">
            <label class="menu-label" id="lang-label">Language</label>
            <select id="language-selector">
                <option value="zh">中文</option>
                <option value="en">English</option>
                <option value="ja">日本語</option>
                <option value="ko">한국어</option>
                <option value="de">Deutsch</option>
                <option value="fr">Français</option>
                <option value="ar">العربية</option>
            </select>
        </div>

    </div>
    
    <div id="canvas-container"></div>
    
    <script>
        // Configuration objects
        const config = {
            particleColor: 'red',
            backgroundColor: 'blue',
            currentCode: 'code1',
            particleSize: 1.6, // Default particle size
            canvasBase: 140 // Default canvas base size
        };
        
        // Dynamic canvas size calculation
        const getCanvasSize = () => ({
            width: config.canvasBase * 3,
            height: config.canvasBase * 4
        });
        
        // Language translations
        const translations = {
            zh: {
                title: '生成艺术 & 裸眼3D',
                codeLabel: '代码选择',
                particleLabel: '粒子颜色',
                bgLabel: '背景颜色',
                langLabel: '语言',
                sizeLabel: '粒子大小',
                canvasLabel: '画布大小',
                bgText1: '数学、人工生命、模拟。',
                bgText2: '数学算法驱动',
                bgText3: '数学之美 · 代码艺术',
            },
            en: {
                title: 'Generative Art & Glasses-Free 3D',
                codeLabel: 'Code Selection',
                particleLabel: 'Particle Color',
                bgLabel: 'Background Color',
                langLabel: 'Language',
                sizeLabel: 'Particle Size',
                canvasLabel: 'Canvas Size',
                bgText1: 'Mathematics, Artificial Life, Simulation.',
                bgText2: 'Driven by Mathematical Algorithms',
                bgText3: 'Beauty of Math · Code Art',
            },
            ja: {
                title: 'ジェネラティブアート & 裸眼3D',
                codeLabel: 'コード選択',
                particleLabel: 'パーティクル色',
                bgLabel: '背景色',
                langLabel: '言語',
                sizeLabel: 'パーティクルサイズ',
                canvasLabel: 'キャンバスサイズ',
                bgText1: '数学、人工生命、シミュレーション。',
                bgText2: '数学アルゴリズム駆動',
                bgText3: '数学の美・コードアート',
            },
            ko: {
                title: '생성 예술 & 무안경 3D',
                codeLabel: '코드 선택',
                particleLabel: '입자 색상',
                bgLabel: '배경 색상',
                langLabel: '언어',
                sizeLabel: '입자 크기',
                canvasLabel: '캔버스 크기',
                bgText1: '수학, 인공생명, 시뮬레이션.',
                bgText2: '수학적 알고리즘 기반',
                bgText3: '수학의 아름다움 · 코드 예술',
            },
            de: {
                title: 'Generative Kunst & 3D ohne Brille',
                codeLabel: 'Codeauswahl',
                particleLabel: 'Teilchenfarbe',
                bgLabel: 'Hintergrundfarbe',
                langLabel: 'Sprache',
                sizeLabel: 'Teilchengröße',
                canvasLabel: 'Bildschirmgröße',
                bgText1: 'Mathematik, künstliche Lebewesen, Simulation.',
                bgText2: 'Durch mathematische Algorithmen angetrieben',
                bgText3: 'Schönheit der Mathematik · Codekunst',
            },
            fr: {
                title: 'Art Générative & 3D sans Lunettes',
                codeLabel: 'Sélection de Code',
                particleLabel: 'Couleur des Particules',
                bgLabel: 'Couleur de Fond',
                langLabel: 'Langue',
                sizeLabel: 'Taille des Particules',
                canvasLabel: 'Taille de l\'Écran',
                bgText1: 'Mathématiques, Vie Artificielle, Simulation.',
                bgText2: 'Propulsé par des Algorithmes Mathématiques',
                bgText3: 'Beauté des Mathématiques · Art de Code',
            },
            ar: {
                title: 'فن جنراتيف & 3D بدون عدسات',
                codeLabel: 'اختيار الكود',
                particleLabel: 'لون الجسيمات',
                bgLabel: 'لون الخلفية',
                langLabel: 'اللغة',
                sizeLabel: 'حجم الجسيمات',
                canvasLabel: 'حجم الشاشة',
                bgText1: 'الرياضيات، الحياة الاصطناعية، التشابه.',
                bgText2: 'منطوق بأساليب رياضية',
                bgText3: 'جمال الرياضيات · الفن البرمجي',
            }
        };
        
        // Color configurations
        const colors = {
            particle: {
                red: [247, 8, 145],
                orange: [255, 127, 80],
                yellow: [255, 215, 0],
                'pure-red': [255, 0, 0]
            },
            background: {
                blue: [32, 0, 251],
                cyan: [0, 184, 148],
                purple: [108, 92, 231],
                black: [0, 0, 0]
            }
        };
        
        // Code variations
        const codeVariations = {
            code1: `a=(x,y,d=mag(k=(4+sin(y*2-t)*3)*cos(x/29),e=y/8-13))=>point((q=3*sin(k*2)+.3/k+sin(y/25)*k*(9+4*sin(e*9-d*3+t*2)))+30*cos(c=d-t)+200,q*sin(c)+d*39-220)
t=0,draw=$=>{t||createCanvas(w=400,w);background(9).stroke(w,96);for(t+=PI/240,i=1e4;i--;)a(i,i/235)} // From: x/yuruyurao`,
            code2: `a=(x,y,d=mag(k=5*cos(x/19)*cos(y/30),e=y/8-12)**2/59+2)=>point((q=4*sin(atan2(k,e)*9)+9*sin(d-t)-k/d*(9+sin(d*9-t*16)*3))+50*cos(c=d*d/7-t)+200,q*sin(c)+d*45-9)
t=0,draw=$=>{t||createCanvas(w=400,w);background(9).stroke(w,36);for(t+=PI/240,i=1e4;i--;)a(i,i/41)} // From: x/yuruyurao`,
            code3: `a=(x,y,d=mag(k=(4+sin(x/11+t*8))*cos(x/14),e=y/8-19)+sin(y/9+t*2))=>point((q=2*sin(k*2)+sin(y/17)*k*(9+2*sin(y-d*3)))+50*cos(c=d*d/49-t)+200,q*sin(c)+d*39-440)
t=0,draw=$=>{t||createCanvas(w=400,w);background(9).stroke(w,96);for(t+=PI/240,i=1e4;i--;)a(i,i/235)} // From: x/yuruyurao`,
            code4: `a=(x,y,d=mag(k=(4+cos(y))*cos(x/4),e=y/8-20))=>point((q=sin(k*3)+sin(y/19+9)*k*(6+sin(e*14-d)))*cos(d/8+t/4)+50*cos(c=d-t)+200,q*sin(c)+d*7*sin(c/4)+200)
t=0,draw=$=>{t||createCanvas(w=400,w);background(9).stroke(w,116);for(t+=PI/120,i=1e4;i--;)a(i,i/235)} // From: x/yuruyurao`,
            code5: `a=(x,y,d=mag(k=4*cos(x/29),e=y/7-13))=>point((q=3*sin(atan2(k,e)*19)+sin(y/19)*k*(9+2*sin(e*9-d*3+t/4)))+60*cos(c=d-t/8)+200,q*sin(c)+d*39-195)
t=0,draw=$=>{t||createCanvas(w=400,w);background(9).stroke(w,146);for(t+=PI/15,i=1e4;i--;)a(i,i/235)} // From: x/yuruyurao`,
            code6: `a=(x,y,d=mag(k=5*cos(x/14)*cos(y/30),e=y/8-13)**2/59+4)=>point((q=60-3*sin(atan2(k,e)*e)+k*(3+4/d*sin(d*d-t*2)))*sin(c=d/2+e/99-t/18)+200,(q+d*9)*cos(c)+200)
t=0,draw=$=>{t||createCanvas(w=400,w);background(9).stroke(w,66);for(t+=PI/20,i=1e4;i--;)a(i%200,i/43)} // From: x/yuruyurao`,
            code7: `a=(x,y,d=mag(k=11*cos(x/8),e=y/8-12.5)**3/1499+cos(e/4+t*2)/5+1)=>point((q=99-e*sin(e)/d+k*(3+sin(d*d-t*2)))*sin(c=d/2+e/99-t/8)+200,(q+19*d)*cos(c)+200)
t=0,draw=$=>{t||createCanvas(w=400,w);background(9).stroke(w,66);for(t+=PI/90,i=1e4;i--;)a(i%200,i/50)} // From: x/yuruyurao`,
            code8: `a=(x,y,o=mag(k=x/4-12.5,e=y/9)/9)=>point((q=99+3*(tan(y/2)/2+cos(y))/k+k*(3+cos(y)/3+sin(e+o*4-t*2)))*cos(c=o/4+e/4-t/8)*cos(c/2-e/3+t/8)+200,q*sin(c)+200)
t=0,draw=$=>{t||createCanvas(w=400,w);background(6).stroke(w,46);for(t+=PI/90,i=3e4;i--;)a(i%100,i/350)} // From: x/yuruyurao`,
            code9: `a=(x,y,o=mag(k=x/4-12.5,e=y/9)/9)=>point((q=x/3+99+3/k*sin(y)+k*(1+cos(y)/3+sin(e+o*4-t*2)))*cos(c=o/5+e/4-t/8)+200,(q+49)*sin(c)*cos(c)-q/3+30*o+220)
t=0,draw=$=>{t||createCanvas(w=400,w);background(6).stroke(w,46);for(t+=PI/90,i=2e4;i--;)a(i%100,i/350)} // From: x/yuruyurao`,
            code10: `a=(x,y,d=abs(e=cos(k=x/8-12.5)+sin(y/24)+cos(k/2)))=>point((q=x/4+90+d*k*(1+cos(d*4-t*2+y/72)))*cos(c=y*e/594-t/8+d/6)+200,(q/2+99*cos(c/2))*sin(c)+e*6+200)
t=0,draw=$=>{t||createCanvas(w=400,w);background(6).stroke(w,36);for(t+=PI/60,i=4e4;i--;)a(i%200,i/200)} // From: x/yuruyurao`,
            code11: `a=(x,y,k=x/8-12.5,d=abs(e=cos(k)+sin(y/3)+cos(k/2)))=>point((q=x/4+90+d*k*(.5+cos(d*4-t*2+y/12)))*.7*(cos(c=y*e/198-t/8+d/5))+200,(q+70)*.7*sin(c)+200)
t=0,draw=$=>{t||createCanvas(w=400,w);background(0,96).stroke(w,26);for(t+=PI/90,i=4e4;i--;)a(i%200,i/500)} // From: x/yuruyurao`,
            code12: `a=(x,y,k=x/8-12.5,d=cos(k/2)+sin(y/3)-.5)=>point((q=x/4+60+d*k*(1+cos(d*4-t*2+y/14)))*.7*cos(c=y*d/169-t/8+d/9)+200+60*sin(t*3/32+c/4),(q+59)*.7*sin(c)+200)
t=0,draw=$=>{t||createCanvas(w=400,w);background(0).stroke(w,36);for(t+=PI/30,i=4e4;i--;)a(i%200,i/400)} // From: x/yuruyurao`,
            code13: `a=(x,y,k=x/12-12.5,d=abs(cos(k/2)+sin(y/2)*cos(k/5)/2+1))=>point((q=x/4+99+(d+0)*k*(.5+cos(d*2-t+y/8)))*.8*cos(c=y/69-t/8+d/6)+200,q/2*cos(c+d/3+y/69)+200)
t=0,draw=$=>{t||createCanvas(w=400,w);background(0).stroke(w,46);for(t+=PI/30,i=4e4;i--;)a(i%300,i/300)} // From: x/yuruyurao`,
            code14: `a=(x,y,k=x/12-12.5,d=2*abs(cos(k/2)+sin(y/4)+cos(k/8)))=>point((q=x/4+90+(d)*k*cos(d-t*2+y/24))*.7*cos(c=y/79-t/8+d/8)+q/8*sin(c*4)+200,(q)*.7*sin(c)+200)
t=0,draw=$=>{t||createCanvas(w=400,w);background(0).stroke(w,36);for(t+=PI/60,i=4e4;i--;)a(i%300,i/300)} // From: x/yuruyurao`,
            code15: `a=(x,y,k=x/8-12.5,d=abs(cos(k/2)+sin(y/4)))=>
point((q=x/4+90+(d+.1)*k*cos(d-t*2+y/24))*.7*cos(c=y/99-t/8+d*d/32)+200,(q+y)*.7*sin(c)+(q-y)/2*cos(c*2)+200)
t=0,draw=$=>{t||createCanvas(w=400,w);background(0).stroke(w,36);for(t+=PI/60,i=4e4;i--;)a(i%200,i/300)} // From: x/yuruyurao`,
            code16: `a=(x,y,o=mag(k=x/4-12.5,e=y/9+5)/9)=>point((q=x+99+tan(1/k)+o*k*(cos(e*9)/4+cos(y/2))*sin(o*4-t))*.7*sin(c=o*e/30-t/8)+9*cos(y/19+t)+200,200+q/2*cos(c))
t=0,draw=$=>{t||createCanvas(w=400,w);background(6).stroke(w,46);for(t+=PI/90,i=2e4;i--;)a(i%100,i/100)} // From: x/yuruyurao`,
            code17: `a=(x,y,k=x/16-12.5,d=-5*abs(sin(k/3)*sin(y/24)))=>point((q=x/4-y/3+60+(sin(t)+d*3+3)*k*sin(d*3+t+sin(d)))*.7*cos(c=d/2+t/8)+200,(q+y/2-d*19)*.7*sin(c)+200)
t=0,draw=$=>{t||createCanvas(w=400,w);background(6).stroke(w,36);for(t+=PI/90,i=4e4;i--;)a(i%400,i/400)} // From: x/yuruyurao`,
            code18: `a=(x,y,o=3-mag(k=x/8-12.5,e=y/8-12)/3,d=-4*(sin(k/2)*cos(e)))=>point((x+e*cos(t)+d*k*sin(d+t))*.7+k*o+130,(y-d*19+d*e*cos(d+t))*.7+130)
t=0,draw=$=>{t||createCanvas(w=400,w);background(6,96).stroke(w,46);for(t+=PI/90,i=4e4;i--;)a(i%200,i/200)} // From: x/yuruyurao`,
            code19: `a=(x,y,o=2-mag(k=x/8-12,e=y/8-12)/3,d=-5*abs(sin(k/2)*cos(e*.8)))=>point((x-d*k*4+d*k*sin(d+t))*.7+k*o*2+130,(y-d*y/5+d*e*cos(d+t+o)*sin(t+d))*.7+e*o+70)
t=0,draw=$=>{t||createCanvas(w=400,w);background(6,96).stroke(w,46);for(t+=PI/90,i=4e4;i--;)a(i%200,i/200)} // From: x/yuruyurao`,
            code20: `a=(x,y,d=5*cos(o=mag(k=x/8-12.5,e=y/8-12.5)/12*cos(sin(k/2)*cos(e/2))))=>
point((x+d*k*(sin(d*2+t)+sin(y*o*o)/9))/1.5+133,(y/3-d*40+19*cos(d+t))*1.5+300)
t=0,draw=$=>{t||createCanvas(w=400,w);background(6,96).stroke(w,46);for(t+=PI/90,i=4e4;i--;)a(i%200,i/200)} // From: x/yuruyurao`,
            code21: `a=(x,y,o=mag(k=x/4-12.5,e=y/9+9)/9)=>point((q=x+99+tan(1/k)+o*k*(cos(e*9)/2+cos(y/9)/.7)*sin(o*4-t*2))*.7*sin(c=o*e/30-t/8)+200,200+y*cos(c*4-o)-q/2*cos(c))
t=0,draw=$=>{t||createCanvas(w=400,w);background(6).stroke(w,46);for(t+=PI/60,i=2e4;i--;)a(i%100,i/250)} // From: x/yuruyurao`,
            code22: `a=(x,y,d=5*cos(o=mag(k=x/8-12,e=y/13-14)/2))=>
point((q=x/2+10+1/k+k*cos(e)*sin(d*8-t))*sin(c=d/3+t/8)+sin(d*2+t)*k+200,(y/4+5*o*o+q*cos(c*3))/2*cos(c)+200)
t=0,draw=$=>{t||createCanvas(w=400,w);background(6).stroke(w,66);for(t+=PI/60,i=2e4;i--;)a(i%200,i/200)} // From: x/yuruyurao`,
            code23: `a=(x,y,o=mag(k=x/4-12.5,e=y/9+9)/9)=>point((q=x+99+tan(1/k)+o*k*(cos(e*9)/2+cos(y/9)/.7)*sin(o*4-t*2))*.7*sin(c=o*e/30-t/8)+200,200+y*cos(c*4-o)-q/2*cos(c))
t=0,draw=$=>{t||createCanvas(w=400,w);background(6).stroke(w,66);for(t+=PI/60,i=2e4;i--;)a(i%100,i/250)} // From: x/yuruyurao`,
            code24: `a=(x,y,d=.5+5*cos(o=mag(k=x/8-12.5,e=y/8-12.5)**2/169))=>point(x+d*k*sin(d*2+o+t)+e*cos(e+t)+100,o*135-y/4-d*6*cos(d*3+o*9+t)+125)
t=0,draw=$=>{t||createCanvas(w=400,w);background(6);for(t+=PI/120,i=4e4;i--;)a(i%200,i/200)} // From: x/yuruyurao`,
            code25: `a=(x,y,o=mag(k=x/8-12.5,e=y/8-9)/4)=>point((q=x+y+e/k+o*k*cos(y/3)*sin(o*2-t)*o/2)/3*atan(3*sin(c=o*e/40-t/8))+200,o*sin(x/9)-y*cos(c)+q/4*cos(c)+200)
t=0,draw=$=>{t||createCanvas(w=400,w);background(6);for(t+=PI/120,i=2e4;i--;)a(i%200,i/200<<1)} // From: x/yuruyurao`,
            code26: `a=(x,y,d=9*cos(o=mag(k=x/8-12.5,e=y/8-12.5)**2/139))=>point((x+sin(d)*d*k)/2+150+o*k*sin(t+d*o),y/9-d*15-cos(d*2)*d+220+d*sin(d-t))
t=0,draw=$=>{t||createCanvas(w=400,w);background(6);for(t+=PI/90,i=4e4;i--;)a(i%200,i/200)} // From: x/yuruyurao`,
            code27: `a=(x,y,d=5*cos(mag(k=x/8-12.5,e=y/8-12.5)/3))=>point((x+(d*k+k*3)*sin(d*2.5-t))/2+150,d*13+(d*3+12)*(3+cos(d*3-t))+d*e+150)
t=0,draw=$=>{t||createCanvas(w=400,w);background(6);for(t+=PI/60,i=4e4;i--;)a(i%200,i/200)} // From: x/yuruyurao`,
            code28: `a=(x,y,d=mag(k=x/8-12,e=y/8-9)**2/50)=>point((q=x/3+e+60+1/k+k/sin(e)*sin(d-t))*sin(c=d/4-t/8)+200,(q-y*d/9)*cos(c)+200)
t=0,draw=$=>{t||createCanvas(w=400,w);background(6);for(t+=PI/90,i=1e4;i--;)a(i%200,i/200<<2)} // From: x/yuruyurao`,
            code29: `t=0,draw=$=>{t||createCanvas(w=400,w);background(6).stroke(255,66);for(t+=PI/60,y=99;y<300;y+=3)for(x=99;++x<300;)o=mag(k=x/8-25,e=y/8-25)/4,point((q=x+y/3+k/cos(y/8)+1/k+o*k*cos(y/8-t)*sin(o*4-t))/3*atan(2*sin(c=o*e/50-t/8))+200,(y*tan(c)+q)/3*cos(c)+200)} // From: x/yuruyurao`,
            code30: `a=(x,y,d=mag(k=x/8-25,e=y/8-25)**2/99)=>[(q=x/3+k*.5/cos(y*5)*sin(d*d-t))*sin(c=d/2-t/8)+e*sin(d+k-t)+200,(q+y/8+d*9)*cos(c)+200]
t=0,draw=$=>{t||createCanvas(w=400,w);background(6).stroke(255,96);for(t+=PI/60,y=99;y<300;y+=5)for(x=99;++x<300;)point(...a(x,y))} // From: x/yuruyurao`,
            code31: `a=(x,y,d=cos(mag(k=x/8-25,e=y/8-25)/3)*e/5)=>[(q=x/4+k/cos(y/9)*sin(d*9-t)+25)*sin(c=d-t/8)+200,(q*2+x+y/2+d*90)/4*cos(c)+200]
t=0,draw=$=>{t||createCanvas(w=400,w);background(6,36).stroke(255,36);for(t+=PI/60,y=99;y<300;y+=2)for(x=99;++x<300;)point(...a(x,y))} // From: x/yuruyurao`,
            code32: `a=(x,y,d=5*cos(o=mag(k=x/8-25,e=y/8-25)/3))=>[(q=x/2+k/atan(9*cos(e))*sin(d*4-t))*sin(c=d/3-t/8)+200,(y/3+d+q)/2*cos(c)+200]
t=0,draw=$=>{t||createCanvas(w=400,w);background(6,19);for(t+=PI/60,y=99;++y<300;)for(x=99;++x<300;)point(...a(x,y))} // From: x/yuruyurao`,
            code33: `a=(x,y,d=5*cos(o=mag(k=x/8-25,e=y/8-25)/3))=>[(q=x/2+k/atan(9*cos(e))*sin(d*4-t))*sin(c=d/3-t/8)+200,(y/4+5*o*o+q)/2*cos(c)+200]
t=0,draw=$=>{t||createCanvas(w=400,w);background(6).stroke(255,96);for(t+=PI/60,y=99;++y<300;)for(x=99;++x<300;)point(...a(x,y))} // From: x/yuruyurao`,
            code34: `a=(x,y,d=cos(o=mag(k=x/8-25,e=y/8-25)/(4+sin(k*e/49-t))))=>[(q=k/cos(e)*sin(d*9)+x/3)*cos(c=o+t/8)+200,(y/2+q)/2*sin(c)+200]
t=0,draw=$=>{t||createCanvas(w=400,w);background(6).stroke(255,96);for(t+=PI/90,y=99;y<300;y+=2)for(x=99;++x<300;)point(...a(x,y))} // From: x/yuruyurao`,
            code35: `a=(x,y,d=5*cos(o=mag(k=x/8-25,e=y/8-25)/3.5))=>[(k*atan(3*cos(d*9))+x/2)*cos(c=(d+o)/4-t/8)+200,(k*d*cos(o-d+t)+y/2)*sin(c)+200]
t=0,draw=$=>{t||createCanvas(w=400,w);background(6).stroke(255,96);for(t+=PI/60,y=99;y<300;y+=2)for(x=99;++x<300;)point(...a(x,y))} // From: x/yuruyurao`,
            code36: `a=(x,y,d=5*cos(mag(k=x/8-25,e=y/8-25)/3))=>[(x+(d*k+k*2*atan(9*cos(e*2-t/2)))*sin(d*2.5-t))/2+100,d*13+d*3*(3+cos(d*3-t))+d*e+200]
t=0,draw=$=>{t||createCanvas(w=400,w);background(6).stroke(255,66);for(t+=PI/120,y=99;++y<300;)for(x=99;++x<300;)point(...a(x,y))} // From: x/yuruyurao`,
            code37: `a=(x,y,d=5*cos(mag(k=x/8-25,e=y/8-25)/3))=>[(x+d*k*sin(d*2.5-t)+k/2*sin(y/3+t))/2+100,d*19+(d-2)*5*abs(cos(d/2-t/2))+d*e+215]
t=0,draw=$=>{t||createCanvas(w=400,w);background(6).stroke(255,66);for(t+=PI/60,y=100;y<300;y++)for(x=100;x<300;x++)point(...a(x,y))} // From: x/yuruyurao`,
        };

        // Background text with current language
        let currentLang = 'en'; // Default to English
        
        // Detect browser language
        const detectBrowserLanguage = () => {
            // Get browser language
            const browserLang = navigator.language || navigator.userLanguage;
            const langCode = browserLang.toLowerCase().substring(0, 2);
            
            // Map browser language codes to our supported languages
            const supportedLangs = {
                'zh': 'zh',
                'en': 'en', 
                'ja': 'ja',
                'ko': 'ko',
                'de': 'de',
                'fr': 'fr',
                'ar': 'ar'
            };
            
            // Return supported language or default to English
            return supportedLangs[langCode] || 'en';
        };
        
        const drawBackgroundText = () => {
            noStroke();
            textAlign(CENTER, CENTER);
            textFont('Arial, sans-serif');
            const lang = translations[currentLang];
            
            // Use blue text for black background, otherwise use black text
            const isBlackBackground = config.backgroundColor === 'black';
            const textColor = isBlackBackground ? [5, 25, 255] : [0, 0, 0];
            
            const { width, height } = getCanvasSize();

            const scaleFactor = config.canvasBase / 140;
            
            for (let offset = 0; offset < 5; offset++) {
                fill(textColor[0], textColor[1], textColor[2], isBlackBackground ? (150 - offset * 40) : (90 - offset * 40) );
                textSize(20 * scaleFactor);
                text(lang.bgText1, width/2 + offset, height / 3 - 20 * scaleFactor + offset);
                text(lang.bgText2, width/2 + offset, height / 3 + offset);
                textSize(20 * scaleFactor);
                text(lang.bgText3, width/2 + offset, height / 3 * 2 + offset);
            }
        };

        const refreshBackground = () => {
            const bgColor = colors.background[config.backgroundColor];
            background(bgColor[0], bgColor[1], bgColor[2]);
            drawBackgroundText();
            
            const particleColor = colors.particle[config.particleColor];
            stroke(particleColor[0], particleColor[1], particleColor[2], 120);
            strokeWeight(config.particleSize); // Apply particle size
        }

        const drawPoint = (x, y) => {
            // Scale coordinates based on canvas size (base 140 = scale factor 1.0)
            const scaleFactor = config.canvasBase / 140;
            point(x * scaleFactor, y * scaleFactor * 4 / 3);
        }

        const init = () => {
            const { width, height } = getCanvasSize();
            createCanvas(width, height).parent('canvas-container');
        }

        const executeCode = (codeString) => {
            // replace createCanvas and background
            codeString = codeString.replace(/createCanvas\([^)]*\)[^;]*;([^f]*(?=for))/g, 'init();refreshBackground();');
            // replace point with drawPoint
            codeString = codeString.replace('point', 'drawPoint');
            eval(codeString);
        }
        
        // Update formula display
        const updateFormulaDisplay = (codeKey) => {
            const formulaDisplay = document.getElementById('formula-display');
            const selectedCode = codeVariations[codeKey];
            
            if (selectedCode) {
                // Extract the formula part (before the first occurrence of 't=0,draw=')
                const formulaPart = selectedCode.split('t=0,draw=')[0].trim();
                const drawPart = selectedCode.split('t=0,draw=')[1];
                
                formulaDisplay.innerHTML = `<span style="color: #4dabf7;">${formulaPart}</span><br>
                    <span style="color: #ffd700;">t=0,draw=${drawPart}</span>`;
            }
        };
        
        // Event handlers
        const updateLanguage = (langCode) => {
            currentLang = langCode;
            const lang = translations[langCode];
            
            // Update UI text
            document.getElementById('main-title').textContent = lang.title;
            document.getElementById('code-label').textContent = lang.codeLabel;
            document.getElementById('particle-label').textContent = lang.particleLabel;
            document.getElementById('bg-label').textContent = lang.bgLabel;
            document.getElementById('lang-label').textContent = lang.langLabel;
            document.getElementById('size-label').textContent = lang.sizeLabel;
            document.getElementById('canvas-label').textContent = lang.canvasLabel;
            
            // Update code selector options to show code numbers
            const codeSelector = document.getElementById('code-selector');
            codeSelector.innerHTML = '';
            Object.keys(codeVariations).forEach(key => {
                const option = document.createElement('option');
                option.value = key;
                // Show code number (extract number from key like 'code1' -> '1')
                const codeNumber = key.replace('code', '');
                option.textContent = `Code ${codeNumber}`;
                if (key === config.currentCode) option.selected = true;
                codeSelector.appendChild(option);
            });
            
            // Update language selector to reflect current selection
            document.getElementById('language-selector').value = langCode;
        };
        
        const updateColors = () => {
            // Reset canvas and restart animation
            clear();
            executeCode(codeVariations[config.currentCode]);
        };

        const updateParticleSize = (increment) => {
            const newSize = parseFloat(document.getElementById('size-display').textContent) + increment;
            if (newSize >= 0.5 && newSize <= 3) { // Example range for particle size
                document.getElementById('size-display').textContent = newSize.toFixed(1);
                config.particleSize = newSize;
                updateColors();
            }
        };

        const updateCanvasSize = (increment) => {
            const newBase = parseInt(document.getElementById('canvas-display').textContent) + increment;
            if (newBase >= 120 && newBase <= 250) { // Canvas base range 100-300
                document.getElementById('canvas-display').textContent = newBase;
                config.canvasBase = newBase; // Update the base size
                const { width, height } = getCanvasSize();
                resizeCanvas(width, height);
                updateColors();
            }
        };
        
        // Initialize p5.js
        function setup() {
            // Detect and set browser language
            const detectedLang = detectBrowserLanguage();
            currentLang = detectedLang;

            const { width, height } = getCanvasSize();
            createCanvas(width, height).parent('canvas-container');
            executeCode(codeVariations[config.currentCode]);
            updateFormulaDisplay(config.currentCode); // Initialize formula display
            
            // Update UI with detected language
            updateLanguage(detectedLang);
            
            // Setup event listeners
            document.getElementById('code-selector').addEventListener('change', (e) => {
                config.currentCode = e.target.value;
                clear();
                executeCode(codeVariations[config.currentCode]);
                updateFormulaDisplay(config.currentCode); // Update formula display on code change
            });
            
            document.getElementById('language-selector').addEventListener('change', (e) => {
                updateLanguage(e.target.value);
            });
            
            // Particle color selection
            document.querySelectorAll('#particle-colors .color-option').forEach(option => {
                option.addEventListener('click', () => {
                    document.querySelectorAll('#particle-colors .color-option').forEach(o => o.classList.remove('active'));
                    option.classList.add('active');
                    config.particleColor = option.dataset.color;
                    updateColors();
                });
            });
            
            // Background color selection
            document.querySelectorAll('#background-colors .color-option').forEach(option => {
                option.addEventListener('click', () => {
                    document.querySelectorAll('#background-colors .color-option').forEach(o => o.classList.remove('active'));
                    option.classList.add('active');
                    config.backgroundColor = option.dataset.color;
                    updateColors();
                });
            });

            // Particle size controls
            document.getElementById('size-decrease').addEventListener('click', () => updateParticleSize(-0.1));
            document.getElementById('size-increase').addEventListener('click', () => updateParticleSize(0.1));

            // Canvas size controls
            document.getElementById('canvas-decrease').addEventListener('click', () => updateCanvasSize(-10));
            document.getElementById('canvas-increase').addEventListener('click', () => updateCanvasSize(10));
        }
    </script>

<code id="formula-display">
</code>
    
</body>
</html>