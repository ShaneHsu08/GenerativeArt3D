<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generative Art & Glasses-Free 3D</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.js"></script>
    <style>
        /* ===== GLOBAL STYLES ===== */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #1d1d1f;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            line-height: 1.6;
        }

        /* ===== HEADER STYLES ===== */
        .header {
            width: 100%;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
            padding: 0 20px;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
        }

        .header-title {
            font-size: 28px;
            font-weight: 600;
            color: #1d1d1f;
            margin: 0;
            letter-spacing: -0.5px;
        }

        .language-selector {
            background: rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 16px;
            padding: 6px 12px;
            font-size: 13px;
            font-weight: 500;
            color: #1d1d1f;
            outline: none;
            transition: all 0.3s ease;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 10px center;
            background-repeat: no-repeat;
            background-size: 14px;
            padding-right: 32px;
        }

        .language-selector:hover {
            background: rgba(0, 0, 0, 0.08);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .language-selector:focus {
            border-color: #007aff;
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.2);
        }

        /* ===== MAIN CONTENT ===== */
        .main-content {
            width: 100%;
            max-width: 1200px;
            padding: 40px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 32px;
        }

        /* ===== CONTROL PANEL ===== */
        .control-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 16px;
            padding: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 16px;
            width: 100%;
            max-width: 900px;
            align-items: start;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
            align-items: center;
            justify-content: flex-start;
            min-height: 60px;
        }

        .control-label {
            font-size: 12px;
            font-weight: 600;
            color: #1d1d1f;
            margin-bottom: 2px;
            text-align: center;
            width: 100%;
        }

        /* ===== FORM CONTROLS ===== */
        .select-control {
            background: rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            padding: 8px 12px;
            font-size: 13px;
            color: #1d1d1f;
            outline: none;
            transition: all 0.3s ease;
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 10px center;
            background-repeat: no-repeat;
            background-size: 14px;
            padding-right: 32px;
            cursor: pointer;
            min-height: 40px;
            box-sizing: border-box;
        }

        .select-control:hover {
            background: rgba(0, 0, 0, 0.08);
            border-color: rgba(0, 0, 0, 0.2);
        }

        .select-control:focus {
            border-color: #007aff;
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.2);
        }

        /* ===== COLOR SELECTORS ===== */
        .color-selector {
            display: flex;
            gap: 8px;
            padding: 8px;
            background: rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            transition: all 0.3s ease;
            min-height: 32px;
            align-items: center;
            justify-content: center;
        }

        .color-option {
            width: 20px;
            height: 20px;
            border-radius: 6px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            position: relative;
        }

        .color-option:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .color-option.active {
            border-color: #007aff;
            box-shadow: 0 0 0 2px rgba(0, 122, 255, 0.2);
        }

        .color-option.active::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 12px;
            font-weight: bold;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        /* Particle Colors */
        .particle-red { background: linear-gradient(135deg, #ff6b6b, #ee5a52); }
        .particle-orange { background: linear-gradient(135deg, #ffa726, #ff9800); }
        .particle-yellow { background: linear-gradient(135deg, #ffeb3b, #ffc107); }
        .particle-pure-red { background: linear-gradient(135deg, #f44336, #d32f2f); }

        /* Background Colors */
        .bg-blue { background: linear-gradient(135deg, #2196f3, #1976d2); }
        .bg-cyan { background: linear-gradient(135deg, #00bcd4, #0097a7); }
        .bg-purple { background: linear-gradient(135deg, #9c27b0, #7b1fa2); }
        .bg-black { background: linear-gradient(135deg, #424242, #212121); }

        /* ===== SIZE CONTROLS ===== */
        .size-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 3px 5px;
            background: rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            min-height: 30px;
        }

        .size-button {
            width: 20px;
            height: 20px;
            border-radius: 6px;
            background: rgba(0, 0, 0, 0.08);
            border: none;
            color: #1d1d1f;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            user-select: none;
        }

        .size-button:hover {
            background: rgba(0, 0, 0, 0.12);
            transform: scale(1.05);
        }

        .size-button:active {
            transform: scale(0.95);
        }

        .size-display {
            background: rgba(0, 0, 0, 0.08);
            border-radius: 6px;
            padding: 6px 8px;
            font-size: 11px;
            font-weight: 600;
            color: #1d1d1f;
            min-width: 50px;
            text-align: center;
        }

        /* ===== CANVAS CONTAINER ===== */
        .canvas-container {
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
            background: #000;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        /* ===== FORMULA DISPLAY ===== */
        .formula-display {
            background: rgba(30, 30, 30, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 16px 20px;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', monospace;
            font-size: 12px;
            color: #e0e0e0;
            white-space: pre-wrap;
            text-align: left;
            max-width: 100%;
            overflow-x: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
            line-height: 1.4;
        }

        /* ===== FOOTER STYLES ===== */
        .footer {
            width: 100%;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            padding: 32px 20px;
            margin-top: auto;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
            text-align: center;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 24px;
            flex-wrap: wrap;
        }

        .footer-link {
            color: #007aff;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            padding: 8px 16px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .footer-link:hover {
            background: rgba(0, 122, 255, 0.1);
            transform: translateY(-2px);
        }

        .footer-link svg {
            width: 16px;
            height: 16px;
            fill: currentColor;
        }

        .footer-divider {
            height: 1px;
            background: linear-gradient(to right, transparent, rgba(0, 0, 0, 0.1), transparent);
            margin: 16px 0;
        }

        .footer-copyright {
            color: #86868b;
            font-size: 12px;
            line-height: 1.4;
        }

        .footer-credits {
            color: #86868b;
            font-size: 13px;
            margin-top: 8px;
        }

        .footer-credits a {
            color: #007aff;
            text-decoration: none;
        }

        .footer-credits a:hover {
            text-decoration: underline;
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 768px) {
            .header-content {
                padding: 12px 0;
            }

            .header-title {
                font-size: 24px;
            }

            .language-selector {
                padding: 5px 10px;
                font-size: 12px;
                padding-right: 28px;
            }

            .main-content {
                padding: 20px 16px;
                gap: 20px;
            }

            .control-panel {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                gap: 12px;
                padding: 12px;
            }

            .footer-links {
                gap: 16px;
            }
        }

        @media (max-width: 480px) {
            .header-content {
                flex-direction: column;
                gap: 12px;
                text-align: center;
            }

            .header-title {
                font-size: 20px;
            }

            .control-panel {
                grid-template-columns: 1fr;
                padding: 12px;
                gap: 12px;
            }

            .size-button {
                width: 20px;
                height: 20px;
                font-size: 12px;
            }

            .color-option {
                width: 20px;
                height: 20px;
            }

            .footer-links {
                flex-direction: column;
                gap: 12px;
            }
        }

        /* ===== ACCESSIBILITY ===== */
        @media (prefers-reduced-motion: reduce) {
            * {
                transition: none !important;
                animation: none !important;
            }
        }

        /* Focus styles for keyboard navigation */
        .size-button:focus,
        .color-option:focus {
            outline: 2px solid #007aff;
            outline-offset: 2px;
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            body {
                background: linear-gradient(135deg, #1c1c1e 0%, #2c2c2e 100%);
                color: #f2f2f7;
            }

            .header,
            .control-panel,
            .footer {
                background: rgba(28, 28, 30, 0.9);
                border-color: rgba(255, 255, 255, 0.1);
            }

            .header-title {
                color: #f2f2f7;
            }

            .control-label {
                color: #f2f2f7;
            }

            .select-control,
            .language-selector {
                background: rgba(255, 255, 255, 0.1);
                border-color: rgba(255, 255, 255, 0.2);
                color: #f2f2f7;
            }

            .color-selector,
            .size-controls {
                background: rgba(255, 255, 255, 0.1);
                border-color: rgba(255, 255, 255, 0.2);
            }

            .size-button {
                background: rgba(255, 255, 255, 0.1);
                color: #f2f2f7;
            }

            .size-display {
                background: rgba(255, 255, 255, 0.1);
                color: #f2f2f7;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <h1 class="header-title" id="main-title">Generative Art & Glasses-Free 3D</h1>
            <select class="language-selector" id="language-selector">
                <option value="zh">中文</option>
                <option value="en">English</option>
                <option value="ja">日本語</option>
                <option value="ko">한국어</option>
                <option value="de">Deutsch</option>
                <option value="fr">Français</option>
                <option value="ar">العربية</option>
            </select>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Control Panel -->
        <div class="control-panel" role="toolbar" aria-label="Art Generation Controls">
            <div class="control-group">
                <label class="control-label" id="particle-label">Particle Color</label>
                <div class="color-selector" role="radiogroup" aria-labelledby="particle-label" id="particle-colors">
                    <div class="color-option particle-red active" data-color="red" role="radio" aria-checked="true" aria-label="Red" tabindex="0"></div>
                    <div class="color-option particle-orange" data-color="orange" role="radio" aria-checked="false" aria-label="Orange" tabindex="-1"></div>
                    <div class="color-option particle-yellow" data-color="yellow" role="radio" aria-checked="false" aria-label="Yellow" tabindex="-1"></div>
                    <div class="color-option particle-pure-red" data-color="pure-red" role="radio" aria-checked="false" aria-label="Pure Red" tabindex="-1"></div>
                </div>
            </div>
            
            <div class="control-group">
                <label class="control-label" id="bg-label">Background Color</label>
                <div class="color-selector" role="radiogroup" aria-labelledby="bg-label" id="background-colors">
                    <div class="color-option bg-blue active" data-color="blue" role="radio" aria-checked="true" aria-label="Blue" tabindex="0"></div>
                    <div class="color-option bg-cyan" data-color="cyan" role="radio" aria-checked="false" aria-label="Cyan" tabindex="-1"></div>
                    <div class="color-option bg-purple" data-color="purple" role="radio" aria-checked="false" aria-label="Purple" tabindex="-1"></div>
                    <div class="color-option bg-black" data-color="black" role="radio" aria-checked="false" aria-label="Black" tabindex="-1"></div>
                </div>
            </div>
            
            <div class="control-group">
                <label class="control-label" id="size-label">Particle Size</label>
                <div class="size-controls" role="group" aria-labelledby="size-label">
                    <button class="size-button" id="size-decrease" aria-label="Decrease particle size">−</button>
                    <div class="size-display" id="size-display" aria-live="polite">1.6</div>
                    <button class="size-button" id="size-increase" aria-label="Increase particle size">+</button>
                </div>
            </div>

                         <div class="control-group">
                 <label class="control-label" id="canvas-label">Canvas Size</label>
                 <div class="size-controls" role="group" aria-labelledby="canvas-label">
                     <button class="size-button" id="canvas-decrease" aria-label="Decrease canvas size">−</button>
                     <div class="size-display" id="canvas-display" aria-live="polite">420x560</div>
                     <button class="size-button" id="canvas-increase" aria-label="Increase canvas size">+</button>
                 </div>
             </div>

            <div class="control-group">
                <label class="control-label" for="code-selector" id="code-label">Code Selection</label>
                <select class="select-control" id="code-selector" aria-describedby="code-help">
                    <!-- Options populated by JavaScript -->
                </select>
            </div>
        </div>
        
        <!-- Canvas Container -->
        <div class="canvas-container" id="canvas-container" role="img" aria-label="Generative art visualization"></div>
        
        <!-- Formula Display -->
        <code class="formula-display" id="formula-display" role="region" aria-label="Current mathematical formula"></code>
    </main>
    
    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-links">
                <a href="https://github.com/ShaneHsu08/GenerativeArt3D" target="_blank" rel="noopener noreferrer" class="footer-link">
                    <svg viewBox="0 0 24 24">
                        <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                    </svg>
                    GitHub
                </a>
                <a href="https://x.com/shenyou_x" target="_blank" rel="noopener noreferrer" class="footer-link">
                    <svg viewBox="0 0 24 24">
                        <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
                    </svg>
                    ShenYouX
                </a>
                <a href="https://dwitter.net" target="_blank" rel="noopener noreferrer" class="footer-link">
                    <svg viewBox="0 0 24 24">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                    </svg>
                    Dwitter
                </a>
                <a href="https://p5js.org" target="_blank" rel="noopener noreferrer" class="footer-link">
                    <svg viewBox="0 0 24 24">
                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                    </svg>
                    p5.js
                </a>
            </div>
            
            <div class="footer-divider"></div>
            
            <div class="footer-copyright">
                <div>© 2025 Generative Art & Glasses-Free 3D Project</div>
                <div class="footer-credits">
                    <span id="footer-credits-text">Special Thanks</span>: <a href="https://twitter.com/yuruyurau" target="_blank">@ア</a> & <a href="https://dwitter.net" target="_blank">Dwitter</a> | 
                    <span id="footer-math-text">Beauty of Math</span> · <span id="footer-code-text">Code Art</span>
                </div>
            </div>
        </div>
    </footer>
    
    <script>
        // ===== CONFIGURATION AND CONSTANTS =====
        const CONFIG = {
            particleColor: 'red',
            backgroundColor: 'blue',
            currentCode: 'code1',
            particleSize: 1.6,
            canvasBase: 140,
            
            // Size limits
            PARTICLE_SIZE_MIN: 0.5,
            PARTICLE_SIZE_MAX: 3.0,
            CANVAS_BASE_MIN: 120,
            CANVAS_BASE_MAX: 250,
            
            // Canvas aspect ratio
            CANVAS_RATIO_WIDTH: 3,
            CANVAS_RATIO_HEIGHT: 4
        };

        // ===== UTILITY FUNCTIONS =====
        const Utils = {
            clamp: (value, min, max) => Math.min(Math.max(value, min), max),
            
            getCanvasSize: () => ({
                width: CONFIG.canvasBase * CONFIG.CANVAS_RATIO_WIDTH,
                height: CONFIG.canvasBase * CONFIG.CANVAS_RATIO_HEIGHT
            }),
            
            detectBrowserLanguage: () => {
                const browserLang = navigator.language || navigator.userLanguage;
                const langCode = browserLang.toLowerCase().substring(0, 2);
                
                const supportedLangs = {
                    'zh': 'zh', 'en': 'en', 'ja': 'ja', 'ko': 'ko',
                    'de': 'de', 'fr': 'fr', 'ar': 'ar'
                };
                
                return supportedLangs[langCode] || 'en';
            }
        };

        // ===== LANGUAGE TRANSLATIONS =====
        const TRANSLATIONS = {
            zh: {
                title: '生成艺术 & 裸眼3D',
                codeLabel: '代码选择',
                particleLabel: '粒子颜色',
                bgLabel: '背景颜色',
                langLabel: '语言',
                sizeLabel: '粒子大小',
                canvasLabel: '画布大小',
                bgText2: '数学算法驱动',
                bgText3: '数学之美 · 代码艺术',
                footerCredits: '特别感谢',
                footerMath: '数学之美',
                footerCode: '代码艺术'
            },
            en: {
                title: 'Generative Art & Glasses-Free 3D',
                codeLabel: 'Code Selection',
                particleLabel: 'Particle Color',
                bgLabel: 'Background Color',
                langLabel: 'Language',
                sizeLabel: 'Particle Size',
                canvasLabel: 'Canvas Size',
                bgText2: 'Driven by Mathematical Algorithms',
                bgText3: 'Beauty of Math · Code Art',
                footerCredits: 'Special Thanks',
                footerMath: 'Beauty of Math',
                footerCode: 'Code Art'
            },
            ja: {
                title: 'ジェネラティブアート & 裸眼3D',
                codeLabel: 'コード選択',
                particleLabel: 'パーティクル色',
                bgLabel: '背景色',
                langLabel: '言語',
                sizeLabel: 'パーティクルサイズ',
                canvasLabel: 'キャンバスサイズ',
                bgText2: '数学アルゴリズム駆動',
                bgText3: '数学の美・コードアート',
                footerCredits: '特別感謝',
                footerMath: '数学の美',
                footerCode: 'コードアート'
            },
            ko: {
                title: '생성 예술 & 무안경 3D',
                codeLabel: '코드 선택',
                particleLabel: '입자 색상',
                bgLabel: '배경 색상',
                langLabel: '언어',
                sizeLabel: '입자 크기',
                canvasLabel: '캔버스 크기',
                bgText2: '수학적 알고리즘 기반',
                bgText3: '수학의 아름다움 · 코드 예술',
                footerCredits: '특별 감사',
                footerMath: '수학의 아름다움',
                footerCode: '코드 예술'
            },
            de: {
                title: 'Generative Kunst & 3D ohne Brille',
                codeLabel: 'Codeauswahl',
                particleLabel: 'Teilchenfarbe',
                bgLabel: 'Hintergrundfarbe',
                langLabel: 'Sprache',
                sizeLabel: 'Teilchengröße',
                canvasLabel: 'Bildschirmgröße',
                bgText2: 'Durch mathematische Algorithmen angetrieben',
                bgText3: 'Schönheit der Mathematik · Codekunst',
                footerCredits: 'Besondere Dank',
                footerMath: 'Schönheit der Mathematik',
                footerCode: 'Codekunst'
            },
            fr: {
                title: 'Art Générative & 3D sans Lunettes',
                codeLabel: 'Sélection de Code',
                particleLabel: 'Couleur des Particules',
                bgLabel: 'Couleur de Fond',
                langLabel: 'Langue',
                sizeLabel: 'Taille des Particules',
                canvasLabel: 'Taille de l\'Écran',
                bgText2: 'Propulsé par des Algorithmes Mathématiques',
                bgText3: 'Beauté des Mathématiques · Art de Code',
                footerCredits: 'Remerciements Spéciaux',
                footerMath: 'Beauté des Mathématiques',
                footerCode: 'Art de Code'
            },
            ar: {
                title: 'فن جنراتيف & 3D بدون عدسات',
                codeLabel: 'اختيار الكود',
                particleLabel: 'لون الجسيمات',
                bgLabel: 'لون الخلفية',
                langLabel: 'اللغة',
                sizeLabel: 'حجم الجسيمات',
                canvasLabel: 'حجم الشاشة',
                bgText2: 'منطوق بأساليب رياضية',
                bgText3: 'جمال الرياضيات · الفن البرمجي',
                footerCredits: 'شكر خاص',
                footerMath: 'جمال الرياضيات',
                footerCode: 'الفن البرمجي'
            }
        };

        // ===== COLOR DEFINITIONS =====
        const COLORS = {
            particle: {
                red: [247, 8, 145],
                orange: [255, 127, 80],
                yellow: [255, 215, 0],
                'pure-red': [255, 0, 0]
            },
            background: {
                blue: [32, 0, 251],
                cyan: [0, 184, 148],
                purple: [108, 92, 231],
                black: [0, 0, 0]
            }
        };

        // ===== CODE VARIATIONS =====
        const CODE_VARIATIONS = {
            code1: `a=(x,y,d=mag(k=(4+sin(y*2-t)*3)*cos(x/29),e=y/8-13))=>point((q=3*sin(k*2)+.3/k+sin(y/25)*k*(9+4*sin(e*9-d*3+t*2)))+30*cos(c=d-t)+200,q*sin(c)+d*39-220)
t=0,draw=$=>{t||createCanvas(w=400,w);background(9).stroke(w,96);for(t+=PI/240,i=1e4;i--;)a(i,i/235)} // From: x/yuruyurau`,
            code2: `a=(x,y,d=mag(k=5*cos(x/19)*cos(y/30),e=y/8-12)**2/59+2)=>point((q=4*sin(atan2(k,e)*9)+9*sin(d-t)-k/d*(9+sin(d*9-t*16)*3))+50*cos(c=d*d/7-t)+200,q*sin(c)+d*45-9)
t=0,draw=$=>{t||createCanvas(w=400,w);background(9).stroke(w,36);for(t+=PI/240,i=1e4;i--;)a(i,i/41)} // From: x/yuruyurau`,
            code3: `a=(x,y,d=mag(k=(4+sin(x/11+t*8))*cos(x/14),e=y/8-19)+sin(y/9+t*2))=>point((q=2*sin(k*2)+sin(y/17)*k*(9+2*sin(y-d*3)))+50*cos(c=d*d/49-t)+200,q*sin(c)+d*39-440)
t=0,draw=$=>{t||createCanvas(w=400,w);background(9).stroke(w,96);for(t+=PI/240,i=1e4;i--;)a(i,i/235)} // From: x/yuruyurau`,
            code4: `a=(x,y,d=mag(k=(4+cos(y))*cos(x/4),e=y/8-20))=>point((q=sin(k*3)+sin(y/19+9)*k*(6+sin(e*14-d)))*cos(d/8+t/4)+50*cos(c=d-t)+200,q*sin(c)+d*7*sin(c/4)+200)
t=0,draw=$=>{t||createCanvas(w=400,w);background(9).stroke(w,116);for(t+=PI/120,i=1e4;i--;)a(i,i/235)} // From: x/yuruyurau`,
            code5: `a=(x,y,d=mag(k=4*cos(x/29),e=y/7-13))=>point((q=3*sin(atan2(k,e)*19)+sin(y/19)*k*(9+2*sin(e*9-d*3+t/4)))+60*cos(c=d-t/8)+200,q*sin(c)+d*39-195)
t=0,draw=$=>{t||createCanvas(w=400,w);background(9).stroke(w,146);for(t+=PI/15,i=1e4;i--;)a(i,i/235)} // From: x/yuruyurau`,
            code6: `a=(x,y,d=mag(k=5*cos(x/14)*cos(y/30),e=y/8-13)**2/59+4)=>point((q=60-3*sin(atan2(k,e)*e)+k*(3+4/d*sin(d*d-t*2)))*sin(c=d/2+e/99-t/18)+200,(q+d*9)*cos(c)+200)
t=0,draw=$=>{t||createCanvas(w=400,w);background(9).stroke(w,66);for(t+=PI/20,i=1e4;i--;)a(i%200,i/43)} // From: x/yuruyurau`,
            code7: `a=(x,y,d=mag(k=11*cos(x/8),e=y/8-12.5)**3/1499+cos(e/4+t*2)/5+1)=>point((q=99-e*sin(e)/d+k*(3+sin(d*d-t*2)))*sin(c=d/2+e/99-t/8)+200,(q+19*d)*cos(c)+200)
t=0,draw=$=>{t||createCanvas(w=400,w);background(9).stroke(w,66);for(t+=PI/90,i=1e4;i--;)a(i%200,i/50)} // From: x/yuruyurau`,
            code8: `a=(x,y,o=mag(k=x/4-12.5,e=y/9)/9)=>point((q=99+3*(tan(y/2)/2+cos(y))/k+k*(3+cos(y)/3+sin(e+o*4-t*2)))*cos(c=o/4+e/4-t/8)*cos(c/2-e/3+t/8)+200,q*sin(c)+200)
t=0,draw=$=>{t||createCanvas(w=400,w);background(6).stroke(w,46);for(t+=PI/90,i=3e4;i--;)a(i%100,i/350)} // From: x/yuruyurau`,
            code9: `a=(x,y,o=mag(k=x/4-12.5,e=y/9)/9)=>point((q=x/3+99+3/k*sin(y)+k*(1+cos(y)/3+sin(e+o*4-t*2)))*cos(c=o/5+e/4-t/8)+200,(q+49)*sin(c)*cos(c)-q/3+30*o+220)
t=0,draw=$=>{t||createCanvas(w=400,w);background(6).stroke(w,46);for(t+=PI/90,i=2e4;i--;)a(i%100,i/350)} // From: x/yuruyurau`,
            code10: `a=(x,y,d=abs(e=cos(k=x/8-12.5)+sin(y/24)+cos(k/2)))=>point((q=x/4+90+d*k*(1+cos(d*4-t*2+y/72)))*cos(c=y*e/594-t/8+d/6)+200,(q/2+99*cos(c/2))*sin(c)+e*6+200)
t=0,draw=$=>{t||createCanvas(w=400,w);background(6).stroke(w,36);for(t+=PI/60,i=4e4;i--;)a(i%200,i/200)} // From: x/yuruyurau`,
            code11: `a=(x,y,k=x/8-12.5,d=abs(e=cos(k)+sin(y/3)+cos(k/2)))=>point((q=x/4+90+d*k*(.5+cos(d*4-t*2+y/12)))*.7*(cos(c=y*e/198-t/8+d/5))+200,(q+70)*.7*sin(c)+200)
t=0,draw=$=>{t||createCanvas(w=400,w);background(0,96).stroke(w,26);for(t+=PI/90,i=4e4;i--;)a(i%200,i/500)} // From: x/yuruyurau`,
            code12: `a=(x,y,k=x/8-12.5,d=cos(k/2)+sin(y/3)-.5)=>point((q=x/4+60+d*k*(1+cos(d*4-t*2+y/14)))*.7*cos(c=y*d/169-t/8+d/9)+200+60*sin(t*3/32+c/4),(q+59)*.7*sin(c)+200)
t=0,draw=$=>{t||createCanvas(w=400,w);background(0).stroke(w,36);for(t+=PI/30,i=4e4;i--;)a(i%200,i/400)} // From: x/yuruyurau`,
            code13: `a=(x,y,k=x/12-12.5,d=abs(cos(k/2)+sin(y/2)*cos(k/5)/2+1))=>point((q=x/4+99+(d+0)*k*(.5+cos(d*2-t+y/8)))*.8*cos(c=y/69-t/8+d/6)+200,q/2*cos(c+d/3+y/69)+200)
t=0,draw=$=>{t||createCanvas(w=400,w);background(0).stroke(w,46);for(t+=PI/30,i=4e4;i--;)a(i%300,i/300)} // From: x/yuruyurau`,
            code14: `a=(x,y,k=x/12-12.5,d=2*abs(cos(k/2)+sin(y/4)+cos(k/8)))=>point((q=x/4+90+(d)*k*cos(d-t*2+y/24))*.7*cos(c=y/79-t/8+d/8)+q/8*sin(c*4)+200,(q)*.7*sin(c)+200)
t=0,draw=$=>{t||createCanvas(w=400,w);background(0).stroke(w,36);for(t+=PI/60,i=4e4;i--;)a(i%300,i/300)} // From: x/yuruyurau`,
            code15: `a=(x,y,k=x/8-12.5,d=abs(cos(k/2)+sin(y/4)))=>
point((q=x/4+90+(d+.1)*k*cos(d-t*2+y/24))*.7*cos(c=y/99-t/8+d*d/32)+200,(q+y)*.7*sin(c)+(q-y)/2*cos(c*2)+200)
t=0,draw=$=>{t||createCanvas(w=400,w);background(0).stroke(w,36);for(t+=PI/60,i=4e4;i--;)a(i%200,i/300)} // From: x/yuruyurau`,
            code16: `a=(x,y,o=mag(k=x/4-12.5,e=y/9+5)/9)=>point((q=x+99+tan(1/k)+o*k*(cos(e*9)/4+cos(y/2))*sin(o*4-t))*.7*sin(c=o*e/30-t/8)+9*cos(y/19+t)+200,200+q/2*cos(c))
t=0,draw=$=>{t||createCanvas(w=400,w);background(6).stroke(w,46);for(t+=PI/90,i=2e4;i--;)a(i%100,i/100)} // From: x/yuruyurau`,
            code17: `a=(x,y,k=x/16-12.5,d=-5*abs(sin(k/3)*sin(y/24)))=>point((q=x/4-y/3+60+(sin(t)+d*3+3)*k*sin(d*3+t+sin(d)))*.7*cos(c=d/2+t/8)+200,(q+y/2-d*19)*.7*sin(c)+200)
t=0,draw=$=>{t||createCanvas(w=400,w);background(6).stroke(w,36);for(t+=PI/90,i=4e4;i--;)a(i%400,i/400)} // From: x/yuruyurau`,
            code18: `a=(x,y,o=3-mag(k=x/8-12.5,e=y/8-12)/3,d=-4*(sin(k/2)*cos(e)))=>point((x+e*cos(t)+d*k*sin(d+t))*.7+k*o+130,(y-d*19+d*e*cos(d+t))*.7+130)
t=0,draw=$=>{t||createCanvas(w=400,w);background(6,96).stroke(w,46);for(t+=PI/90,i=4e4;i--;)a(i%200,i/200)} // From: x/yuruyurau`,
            code19: `a=(x,y,o=2-mag(k=x/8-12,e=y/8-12)/3,d=-5*abs(sin(k/2)*cos(e*.8)))=>point((x-d*k*4+d*k*sin(d+t))*.7+k*o*2+130,(y-d*y/5+d*e*cos(d+t+o)*sin(t+d))*.7+e*o+70)
t=0,draw=$=>{t||createCanvas(w=400,w);background(6,96).stroke(w,46);for(t+=PI/90,i=4e4;i--;)a(i%200,i/200)} // From: x/yuruyurau`,
            code20: `a=(x,y,d=5*cos(o=mag(k=x/8-12.5,e=y/8-12.5)/12*cos(sin(k/2)*cos(e/2))))=>
point((x+d*k*(sin(d*2+t)+sin(y*o*o)/9))/1.5+133,(y/3-d*40+19*cos(d+t))*1.5+300)
t=0,draw=$=>{t||createCanvas(w=400,w);background(6,96).stroke(w,46);for(t+=PI/90,i=4e4;i--;)a(i%200,i/200)} // From: x/yuruyurau`,
            code21: `a=(x,y,o=mag(k=x/4-12.5,e=y/9+9)/9)=>point((q=x+99+tan(1/k)+o*k*(cos(e*9)/2+cos(y/9)/.7)*sin(o*4-t*2))*.7*sin(c=o*e/30-t/8)+200,200+y*cos(c*4-o)-q/2*cos(c))
t=0,draw=$=>{t||createCanvas(w=400,w);background(6).stroke(w,46);for(t+=PI/60,i=2e4;i--;)a(i%100,i/250)} // From: x/yuruyurau`,
            code22: `a=(x,y,d=5*cos(o=mag(k=x/8-12,e=y/13-14)/2))=>
point((q=x/2+10+1/k+k*cos(e)*sin(d*8-t))*sin(c=d/3+t/8)+sin(d*2+t)*k+200,(y/4+5*o*o+q*cos(c*3))/2*cos(c)+200)
t=0,draw=$=>{t||createCanvas(w=400,w);background(6).stroke(w,66);for(t+=PI/60,i=2e4;i--;)a(i%200,i/200)} // From: x/yuruyurau`,
            code23: `a=(x,y,o=mag(k=x/4-12.5,e=y/9+9)/9)=>point((q=x+99+tan(1/k)+o*k*(cos(e*9)/2+cos(y/9)/.7)*sin(o*4-t*2))*.7*sin(c=o*e/30-t/8)+200,200+y*cos(c*4-o)-q/2*cos(c))
t=0,draw=$=>{t||createCanvas(w=400,w);background(6).stroke(w,66);for(t+=PI/60,i=2e4;i--;)a(i%100,i/250)} // From: x/yuruyurau`,
            code24: `a=(x,y,d=.5+5*cos(o=mag(k=x/8-12.5,e=y/8-12.5)**2/169))=>point(x+d*k*sin(d*2+o+t)+e*cos(e+t)+100,o*135-y/4-d*6*cos(d*3+o*9+t)+125)
t=0,draw=$=>{t||createCanvas(w=400,w);background(6);for(t+=PI/120,i=4e4;i--;)a(i%200,i/200)} // From: x/yuruyurau`,
            code25: `a=(x,y,o=mag(k=x/8-12.5,e=y/8-9)/4)=>point((q=x+y+e/k+o*k*cos(y/3)*sin(o*2-t)*o/2)/3*atan(3*sin(c=o*e/40-t/8))+200,o*sin(x/9)-y*cos(c)+q/4*cos(c)+200)
t=0,draw=$=>{t||createCanvas(w=400,w);background(6);for(t+=PI/120,i=2e4;i--;)a(i%200,i/200<<1)} // From: x/yuruyurau`,
            code26: `a=(x,y,d=9*cos(o=mag(k=x/8-12.5,e=y/8-12.5)**2/139))=>point((x+sin(d)*d*k)/2+150+o*k*sin(t+d*o),y/9-d*15-cos(d*2)*d+220+d*sin(d-t))
t=0,draw=$=>{t||createCanvas(w=400,w);background(6);for(t+=PI/90,i=4e4;i--;)a(i%200,i/200)} // From: x/yuruyurau`,
            code27: `a=(x,y,d=5*cos(mag(k=x/8-12.5,e=y/8-12.5)/3))=>point((x+(d*k+k*3)*sin(d*2.5-t))/2+150,d*13+(d*3+12)*(3+cos(d*3-t))+d*e+150)
t=0,draw=$=>{t||createCanvas(w=400,w);background(6);for(t+=PI/60,i=4e4;i--;)a(i%200,i/200)} // From: x/yuruyurau`,
            code28: `a=(x,y,d=mag(k=x/8-12,e=y/8-9)**2/50)=>point((q=x/3+e+60+1/k+k/sin(e)*sin(d-t))*sin(c=d/4-t/8)+200,(q-y*d/9)*cos(c)+200)
t=0,draw=$=>{t||createCanvas(w=400,w);background(6);for(t+=PI/90,i=1e4;i--;)a(i%200,i/200<<2)} // From: x/yuruyurau`,
            code29: `t=0,draw=$=>{t||createCanvas(w=400,w);background(6).stroke(255,66);for(t+=PI/60,y=99;y<300;y+=3)for(x=99;++x<300;)o=mag(k=x/8-25,e=y/8-25)/4,point((q=x+y/3+k/cos(y/8)+1/k+o*k*cos(y/8-t)*sin(o*4-t))/3*atan(2*sin(c=o*e/50-t/8))+200,(y*tan(c)+q)/3*cos(c)+200)} // From: x/yuruyurau`,
            code30: `a=(x,y,d=mag(k=x/8-25,e=y/8-25)**2/99)=>[(q=x/3+k*.5/cos(y*5)*sin(d*d-t))*sin(c=d/2-t/8)+e*sin(d+k-t)+200,(q+y/8+d*9)*cos(c)+200]
t=0,draw=$=>{t||createCanvas(w=400,w);background(6).stroke(255,96);for(t+=PI/60,y=99;y<300;y+=5)for(x=99;++x<300;)point(...a(x,y))} // From: x/yuruyurau`,
            code31: `a=(x,y,d=cos(mag(k=x/8-25,e=y/8-25)/3)*e/5)=>[(q=x/4+k/cos(y/9)*sin(d*9-t)+25)*sin(c=d-t/8)+200,(q*2+x+y/2+d*90)/4*cos(c)+200]
t=0,draw=$=>{t||createCanvas(w=400,w);background(6,36).stroke(255,36);for(t+=PI/60,y=99;y<300;y+=2)for(x=99;++x<300;)point(...a(x,y))} // From: x/yuruyurau`,
            code32: `a=(x,y,d=5*cos(o=mag(k=x/8-25,e=y/8-25)/3))=>[(q=x/2+k/atan(9*cos(e))*sin(d*4-t))*sin(c=d/3-t/8)+200,(y/3+d+q)/2*cos(c)+200]
t=0,draw=$=>{t||createCanvas(w=400,w);background(6,19);for(t+=PI/60,y=99;++y<300;)for(x=99;++x<300;)point(...a(x,y))} // From: x/yuruyurau`,
            code33: `a=(x,y,d=5*cos(o=mag(k=x/8-25,e=y/8-25)/3))=>[(q=x/2+k/atan(9*cos(e))*sin(d*4-t))*sin(c=d/3-t/8)+200,(y/4+5*o*o+q)/2*cos(c)+200]
t=0,draw=$=>{t||createCanvas(w=400,w);background(6).stroke(255,96);for(t+=PI/60,y=99;++y<300;)for(x=99;++x<300;)point(...a(x,y))} // From: x/yuruyurau`,
            code34: `a=(x,y,d=cos(o=mag(k=x/8-25,e=y/8-25)/(4+sin(k*e/49-t))))=>[(q=k/cos(e)*sin(d*9)+x/3)*cos(c=o+t/8)+200,(y/2+q)/2*sin(c)+200]
t=0,draw=$=>{t||createCanvas(w=400,w);background(6).stroke(255,96);for(t+=PI/90,y=99;y<300;y+=2)for(x=99;++x<300;)point(...a(x,y))} // From: x/yuruyurau`,
            code35: `a=(x,y,d=5*cos(o=mag(k=x/8-25,e=y/8-25)/3.5))=>[(k*atan(3*cos(d*9))+x/2)*cos(c=(d+o)/4-t/8)+200,(k*d*cos(o-d+t)+y/2)*sin(c)+200]
t=0,draw=$=>{t||createCanvas(w=400,w);background(6).stroke(255,96);for(t+=PI/60,y=99;y<300;y+=2)for(x=99;++x<300;)point(...a(x,y))} // From: x/yuruyurau`,
            code36: `a=(x,y,d=5*cos(mag(k=x/8-25,e=y/8-25)/3))=>[(x+(d*k+k*2*atan(9*cos(e*2-t/2)))*sin(d*2.5-t))/2+100,d*13+d*3*(3+cos(d*3-t))+d*e+200]
t=0,draw=$=>{t||createCanvas(w=400,w);background(6).stroke(255,66);for(t+=PI/120,y=99;++y<300;)for(x=99;++x<300;)point(...a(x,y))} // From: x/yuruyurau`,
            code37: `a=(x,y,d=5*cos(mag(k=x/8-25,e=y/8-25)/3))=>[(x+d*k*sin(d*2.5-t)+k/2*sin(y/3+t))/2+100,d*19+(d-2)*5*abs(cos(d/2-t/2))+d*e+215]
t=0,draw=$=>{t||createCanvas(w=400,w);background(6).stroke(255,66);for(t+=PI/60,y=100;y<300;y++)for(x=100;x<300;x++)point(...a(x,y))} // From: x/yuruyurau`,
            code38: `a=(i,D=i%2-.5,y=i/990,k=(5-sin(y*2-t)*3)*cos(i),e=y/8-9,d=(k*k+e*e)**.6,q=sin(y)*k*e,P=d-t*3)=>point((q+9*cos(P/D+D)+560/4) * 420 / 560 + 90, (D*(d*92 - 990)+300+D*cos(t)*99) / 2.1 + 60)
t=0,draw=$=>{t||createCanvas(w=400,w);background(255).stroke(0,96);for(t+=PI/90,i=1e4;i--;)a(i)} // Dwitter/rodrigo.siqueira`,
            code39: `a=()=>{background(0,0,0,18);q=sin(t);for(i=6e3;i--;){X=cos(i);Y=cos(i*i);Z=cos(i**3);p=cos(t);l=cos(t/2);k=sin(t/2);d=X*q*l+Y*p*l-Z*k+5;let px=(X*p-Y*q)/d*200+200,py=((X*q+Y*p)*k+Z*l)/d*200+200;if(px>=0&&px<=400&&py>=0&&py<=400&&d>0.1)point(px,py)}}
t=0,draw=$=>{t||createCanvas(w=400,w);t+=PI/90;a()} // Dwitter/skeletonNatte`,
            code40: `a=(x,y,d=mag(k=x/8-12.5,e=y/8-12.5),o=sin(d/4+t)*cos(k/5))=>point((x+k*o*sin(d*2+t))*cos(c=d/3-t/8)+200,(y+e*o*cos(d*2+t))*sin(c)+200)
t=0,draw=$=>{t||createCanvas(w=400,w);background(6).stroke(255,96);for(t+=PI/90,i=4e4;i--;)a(i%200,i/200)} // Dwitter-style pattern`
        };

        // ===== APPLICATION STATE =====
        let currentLang = 'en';

        const initCanvas = () => {
            const { width, height } = Utils.getCanvasSize();
            createCanvas(width, height).parent('canvas-container');
        };

        const drawBackgroundText = () => {
            noStroke();
            textAlign(CENTER, CENTER);
            textFont('Arial, sans-serif');
                
            const lang = TRANSLATIONS[currentLang];
            const isBlackBackground = CONFIG.backgroundColor === 'black';
            const textColor = isBlackBackground ? [5, 25, 255] : [0, 0, 0];
            const { width, height } = Utils.getCanvasSize();
            const scaleFactor = CONFIG.canvasBase / 140;
                
            for (let offset = 0; offset < 5; offset++) {
                const opacity = isBlackBackground ? (150 - offset * 40) : (90 - offset * 40);
                fill(textColor[0], textColor[1], textColor[2], opacity);
                textSize(20 * scaleFactor);
                    
                text(lang.bgText2, width/2 + offset, height / 3 + offset);
                text(lang.bgText3, width/2 + offset, height / 3 * 2 + offset);
            }
        };

        const refreshBackground = () => {
            const bgColor = COLORS.background[CONFIG.backgroundColor];
            background(bgColor[0], bgColor[1], bgColor[2]);
            drawBackgroundText();
                
            const particleColor = COLORS.particle[CONFIG.particleColor];
            stroke(particleColor[0], particleColor[1], particleColor[2], 120);
            strokeWeight(CONFIG.particleSize);
        };

        const drawPoint = (x, y) => {
            const scaleFactor = CONFIG.canvasBase / 140;
            point((x + 10) * scaleFactor, (y + 10) * scaleFactor * 4 / 3);
        };

        // ===== P5.JS FUNCTIONS =====
        const executeCode = (codeString) => {
            // replace createCanvas() with initCanvas()
            codeString = codeString.replace(/createCanvas\([^)]*\);/g, 'initCanvas();');
            // replace background() with refreshBackground()
            codeString = codeString.replace(/background[^;]*;/g, 'refreshBackground();');
            // replace point with drawPoint
            codeString = codeString.replace('point', 'drawPoint');
            try {   
                // Execute the code in global scope
                eval(codeString);
            } catch (error) {
                console.error('Code execution error:', error);
                console.log('Failed code:', codeString);
            }
        };

        // ===== UI MANAGEMENT =====
        const UI = {
            updateLanguage(langCode) {
                currentLang = langCode;
                const lang = TRANSLATIONS[langCode];
                
                // Update UI text elements
                const elements = {
                    'main-title': lang.title,
                    'code-label': lang.codeLabel,
                    'particle-label': lang.particleLabel,
                    'bg-label': lang.bgLabel,
                    'size-label': lang.sizeLabel,
                    'canvas-label': lang.canvasLabel
                };
                
                Object.entries(elements).forEach(([id, text]) => {
                    const element = document.getElementById(id);
                    if (element) element.textContent = text;
                });
                
                // Update footer text
                const footerElements = {
                    'footer-credits-text': lang.footerCredits,
                    'footer-math-text': lang.footerMath,
                    'footer-code-text': lang.footerCode
                };
                
                Object.entries(footerElements).forEach(([id, text]) => {
                    const element = document.getElementById(id);
                    if (element) element.textContent = text;
                });
                
                this.updateCodeSelector();
                document.getElementById('language-selector').value = langCode;
            },

            updateCodeSelector() {
                const codeSelector = document.getElementById('code-selector');
                codeSelector.innerHTML = '';
                
                Object.keys(CODE_VARIATIONS).forEach(key => {
                    const option = document.createElement('option');
                    option.value = key;
                    option.textContent = `Code ${key.replace('code', '')}`;
                    if (key === CONFIG.currentCode) option.selected = true;
                    codeSelector.appendChild(option);
                });
            },

            updateFormulaDisplay(codeKey) {
                const formulaDisplay = document.getElementById('formula-display');
                const selectedCode = CODE_VARIATIONS[codeKey];
                
                if (selectedCode && formulaDisplay) {
                    const parts = selectedCode.split('t=0,draw=');
                    const formulaPart = parts[0].trim();
                    const drawPart = parts[1] || '';
                    
                    formulaDisplay.innerHTML = `<span style="color: #4dabf7;">${formulaPart}</span><br><span style="color: #ffd700;">t=0,draw=${drawPart}</span>`;
                }
            },

            updateColors() {
                clear();
                executeCode(CODE_VARIATIONS[CONFIG.currentCode]);
            },

            updateParticleSize(increment) {
                const currentSize = parseFloat(document.getElementById('size-display').textContent);
                const newSize = Utils.clamp(
                    currentSize + increment,
                    CONFIG.PARTICLE_SIZE_MIN,
                    CONFIG.PARTICLE_SIZE_MAX
                );
                
                if (newSize !== currentSize) {
                    document.getElementById('size-display').textContent = newSize.toFixed(1);
                    CONFIG.particleSize = newSize;
                    this.updateColors();
                }
            },

            updateCanvasSize(increment) {
                const currentBase = CONFIG.canvasBase;
                const newBase = Utils.clamp(
                    currentBase + increment,
                    CONFIG.CANVAS_BASE_MIN,
                    CONFIG.CANVAS_BASE_MAX
                );
                
                if (newBase !== currentBase) {
                    CONFIG.canvasBase = newBase;
                    const { width, height } = Utils.getCanvasSize();
                    document.getElementById('canvas-display').textContent = `${width}x${height}`;
                    
                    resizeCanvas(width, height);
                    this.updateColors();
                }
            }
        };

        // ===== EVENT HANDLERS =====
        const EventHandlers = {
            setupColorSelectors() {
                // Particle color selection
                document.querySelectorAll('#particle-colors .color-option').forEach(option => {
                    option.addEventListener('click', () => {
                        document.querySelectorAll('#particle-colors .color-option').forEach(o => {
                            o.classList.remove('active');
                            o.setAttribute('aria-checked', 'false');
                            o.setAttribute('tabindex', '-1');
                        });
                        
                        option.classList.add('active');
                        option.setAttribute('aria-checked', 'true');
                        option.setAttribute('tabindex', '0');
                        CONFIG.particleColor = option.dataset.color;
                        UI.updateColors();
                    });
                });
                
                // Background color selection
                document.querySelectorAll('#background-colors .color-option').forEach(option => {
                    option.addEventListener('click', () => {
                        document.querySelectorAll('#background-colors .color-option').forEach(o => {
                            o.classList.remove('active');
                            o.setAttribute('aria-checked', 'false');
                            o.setAttribute('tabindex', '-1');
                        });
                        
                        option.classList.add('active');
                        option.setAttribute('aria-checked', 'true');
                        option.setAttribute('tabindex', '0');
                        CONFIG.backgroundColor = option.dataset.color;
                        UI.updateColors();
                    });
                });
            },

            setupControlButtons() {
                // Particle size controls
                document.getElementById('size-decrease').addEventListener('click', () => UI.updateParticleSize(-0.1));
                document.getElementById('size-increase').addEventListener('click', () => UI.updateParticleSize(0.1));
                
                // Canvas size controls
                document.getElementById('canvas-decrease').addEventListener('click', () => UI.updateCanvasSize(-10));
                document.getElementById('canvas-increase').addEventListener('click', () => UI.updateCanvasSize(10));
            },

            setupSelectors() {
                // Code selector
                document.getElementById('code-selector').addEventListener('change', (e) => {
                    CONFIG.currentCode = e.target.value;
                    clear();
                    executeCode(CODE_VARIATIONS[CONFIG.currentCode]);
                    UI.updateFormulaDisplay(CONFIG.currentCode);
                });
                
                // Language selector
                document.getElementById('language-selector').addEventListener('change', (e) => {
                    UI.updateLanguage(e.target.value);
                });
            }
        };

        // ===== INITIALIZATION =====
        function setup() {
            // Detect and set browser language
            currentLang = Utils.detectBrowserLanguage();
            
            // Initialize canvas
            const { width, height } = Utils.getCanvasSize();
            createCanvas(width, height).parent('canvas-container');
            
            // Update canvas size display
            document.getElementById('canvas-display').textContent = `${width}x${height}`;
            
            // Execute initial code
            executeCode(CODE_VARIATIONS[CONFIG.currentCode]);
            
            // Update UI
            UI.updateLanguage(currentLang);
            UI.updateFormulaDisplay(CONFIG.currentCode);
            
            // Setup event listeners
            EventHandlers.setupColorSelectors();
            EventHandlers.setupControlButtons();
            EventHandlers.setupSelectors();
        }
    </script>
</body>
</html>